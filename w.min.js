"use strict";!function(e){e.lib.Loader={type:"",preventReload:!0,processType:"server",__construct:function(){e.reg.WjsLoader[this.type]=e.reg.WjsLoader[this.type]||{}},__destruct:e._e,parse:function(e,t,s){return this.enable(e,t,s),t},register:e._e,link:function(e){this.w.use(this.type,e)},destroy:function(e,t){return this.disable(e,t),!0},enable:e._e,disable:e._e,requestUse:function(e,t){return{mode:this.processType,type:this.type,name:e}},requestDestroy:function(e,t){return{mode:"parse",type:this.type,name:e}},registerListen:function(t,s,r){var o=this;e.registerListen(t,s,function(){o.register.call(o,t,s,r)})}}}(W),function(e){e.lib.Process={phase:0,phases:["bootIsReload","bootRequestFilter","bootGetLoaders","bootFilterLoaders","processStart"],__construct:function(e,t){var s=this.w;t=s.extendOptions(t),s.extendObject(this,{id:s.processCounter++,request:e||{},destroy:t.destroy||!1,async:t.async!==!1,options:t,response:t.response||{},parseQ:{},callbacks:t.complete?[t.complete]:[],exclude:t.exclude,stack:t.stack===!1?!1:t.stack||s.stackCurrent||s.stack,stackInternal:[],output:{},reboot:this.boot.bind(this),responseParseNextProxy:this.responseParseNext.bind(this)}),s.processes[this.id]=this,this.stack?(this.stack.push(this),this.stack.started||(this.stack.started=!0,this.stackNext())):this.boot()},boot:function(){this[this.phases[this.phase]]()&&(this.phase++,this.boot())},bootIsReload:function(){return this.options.reload?(this.phase++,this.w.destroy(this.request,{stack:!1,complete:this.reboot}),!1):!0},bootRequestFilter:function(){var e=this,t=e.w,s={};return t.regEach(this.request,function(r,o){var n,i,a=0,c=e.output,d=t.get(r,o);if(d&&!e.destroy)c[r]=c[r]||{},c[r][o]=d;else{var u;for(i=Object.keys(t.processes);n=i[a++];)if(u=t.processes[n],!Object.isFrozen(u)&&u.destroy===e.destroy&&u.parseQ[r]&&u.parseQ[r][o])return u.itemProcess(r,o,e.reboot),!1;s[r]=s[r]||[],s[r].push(o)}})?(this.request=s,!0):void 0},bootGetLoaders:function(){var e=this;e.phase++,e.w.loadersExists(Object.keys(e.request),this.reboot)},bootFilterLoaders:function(){for(var e,t={},s=Object.keys(this.request),r=0;e=s[r++];)this.w.loaders[e]&&(t[e]=this.request[e]);return this.request=t,!0},processStart:function(){var e,t=this,s=t.w,r=0,o={},n=this.response,i=s.settings,a="request"+(t.destroy?"Destroy":"Use");if(s.regEach(this.request,function(r,c){var d=s.loaders[r][a](c,t);switch(d.mode){case"server":e=i.paramInc+"["+r+"]",o[e]=o[e]?o[e]+","+c:c;break;case"parse":n[r]=n[r]||{},n[r][c]={"#data":d.data}}}),s.objectIsEmpty(o))t.responseParse(n);else{if(t.exclude)if(t.exclude===!0)o[i.paramExc]="1";else for(e=Object.keys(t.exclude),r=0;r<e.length;r++)o[i.paramExc+"["+e[r]+"]"]=t.exclude[e[r]].join(",");i.cacheToken&&(o[i.paramToken]=i.cacheToken),s.ajax({url:i.pathResponse+"?"+s.param(o)+i.paramExtra,method:"GET",success:function(e){s.extendObject(n,JSON.parse(e.responseText),!0),t.responseParse(n)}})}},responseParse:function(e){var t=this,s=t.w,r=t.parseQ;s.extendObject(r,e,!0),s.loadersExists(Object.keys(r),function(){t.async?s.async(t.responseParseNextProxy):t.responseParseNext()})},responseParseNext:function(){var e,t=this.w,s=this.parseQ;return(e=t.regNext(s))?void this.itemProcess(e.type,e.name):(Object.keys(s).length>0&&this.w.err("Parse queue not empty."),void this.processComplete())},itemProcess:function(e,t,s){var r=this.parseQ[e][t];if(s&&(r["#callback"]=s),this.destroy)this.itemDestroy(e,t);else{if(this.w.get(e,t)!==!1)return this.itemProcessComplete(e,t),!1;this.itemParse(e,t,r)}return!0},itemParse:function(t,s,r){var o=this,n=o.w,i=n.extRequire,a="#require",c=o.parseQ,d=function(){o.itemParse(t,s,r)};return i[t][s]=i[t][s]||{},r[a]&&(n.extendObject(i[t][s],r[a]),o.requireMissing(r[a]))?void(n.regEach(r[a],function(e,t){return c[e]&&c[e][t]?(n.loadersExists([e],function(){o.itemProcess(e,t,d)}),!1):void 0})&&(r[a]=void 0,n.use(r[a],{stack:!1,complete:d}))):"string"==typeof r["#data"]&&0===r["#data"].indexOf("cache://")?(n.cacheReg[t+"::"+s]=r["#data"].split("://")[1],void e.registerListen("cache",t+"/"+s,function(e){r["#data"]=e,o.itemParseSave(t,s,e)})):void o.itemParseSave(t,s,r["#data"])},itemParseSave:function(e,t,s){var r,o=this.w,n=o.loaders[e];"string"==typeof s&&0===s.indexOf("WJS5_ERR_")?(o.err("Parse error for "+e+"::"+t+" : "+s),r=new o.window.Error(s)):r=n.parse(t,s,this),r!==!1&&this.itemParseComplete(e,t,r)},itemParseComplete:function(e,t,s){var r=this.output,o=this.w.extLoaded;o[e]&&(o[e][t]=s,r[e]=r[e]||{},r[e][t]=s),this.itemProcessComplete(e,t)},itemDestroy:function(e,t){var s=this.w.get(e,t),r=this.w.loaders[e];r&&s!==!1&&r.destroy(t,s,this)===!1||this.itemDestroyComplete(e,t)},itemDestroyComplete:function(e,t){var s=this,r=s.w,o=e+"::"+t,n=r.cacheReg[o],i=s.options.dependencies?r.requirementsDeletable(e,t):!1;return delete r.extRequire[e][t],delete r.extLoaded[e][t],n&&(r.extendObject(i,r.requirementsDeletable("CacheLink",n)),delete s.w.cacheReg[o]),i&&Object.keys(i).length?void r.destroy(i,{stack:!1,dependencies:!0,complete:function(){s.itemDestroyComplete(e,t)}}):void this.itemProcessComplete(e,t)},itemProcessComplete:function(e,t){var s=this.w,r=this.parseQ[e][t]["#callback"];this.w.regRem(this.parseQ,e,t),r?s.async(r):this.responseParseNext()},processComplete:function(){var e=this.w;if(delete e.processes[this.id],Object.freeze(this),this.callbacks.length){var t=e.stackCurrent;e.stackCurrent=this.stackInternal,e.callbacks(this.callbacks,[this.output,this]),e.stackCurrent=t}this.stack&&this.stackNext()},requireMissing:function(e){var t=!1;return this.w.regEach(e,function(e,s){return this.get(e,s)===!1?(t=!0,!1):void 0}),t},stackNext:function(){this.stack.length?this.stack.shift().boot():this.stack.started=!1}}}(W);var _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol?"symbol":typeof e};!function(e){e.wjsContext=e;var t=function(t,s){var r=arguments.length<=2||void 0===arguments[2]?"load":arguments[2];(s||e).addEventListener(r,t)},s=function(t){this.options=t=this.extendOptions(t),e[t.settings?t.settings.clientName:"w"]=this,"loading"!==this.document.readyState?this.init():this.window.addEventListener("DOMContentLoaded",this.init.bind(this))};s.prototype={context:e,window:e.window||window,document:e.document||window.document,init:function(){var e=this,t=e.options;e.extendObject(e,{version:t.settings?t.settings.version:"[$version]-headless",readyComplete:!1,packageDefault:{},loaders:{},loadersBasic:[],extLoaded:{WjsLoader:{}},extRequire:{WjsLoader:{}},classMethods:{},classProtos:{},processes:{},processCounter:0,stack:[],stackCurrent:!1,cacheReg:{},settings:{clientName:"w",paramExtra:"",paramInc:"",paramExc:"",paramToken:"",pathResponse:"",cachePath:"",cacheToken:""}}),e.extendObject(e,t),e.classExtend("WjsLoader",s.lib.Loader),e.classExtend("WjsProcess",s.lib.Process),e.loaderAdd("JsLink",s.retrieve("WjsLoader","JsLink"),!0),e.loaderAdd("WjsLoader",s.retrieve("WjsLoader","WjsLoader"),!0);for(var r,o=0;r=e.loadersBasic[o++];)e.loaderAdd(r,void 0,!0);e.async=e.window.setTimeout.bind(e.window),e.trigger=s.trigger,e.use(null,{response:e.packageDefault,complete:function(){var r=s.readyCallbacks[e.settings.clientName];e.readyComplete=!0,t.complete&&t.complete.call(e),r&&e.callbacks(r)}})},callbacks:function(e,t,s){for(var r,o=t?"apply":"call",n=0;r=e[n++];)r[o](s||this,t)},urlToken:function(e){var t=this.settings.cacheToken;return t?(-1===e.indexOf("?")?e+"?":e)+"&"+t:e},loaderAdd:function(e,t,s,r){var o=this,n="WjsLoader"+e;if(t=t||{},!o.loaders[e]){if(t.type=e,t.classExtends="WjsLoader"+(t.loaderExtends||""),t.loaderExtends)return void o.loadersExists([t.loaderExtends],function(){o.loaderBuild(e,n,t,s,r)});o.loaderBuild(e,n,t,s,r)}},loaderBuild:function(e,t,s,r,o){this.classExtend(t,s),this.loaders[e]=new(this.classProto(t))(e),this.extRequire[e]={};var n=this.extLoaded;n[e]=n[e]||{},r&&(n.WjsLoader[e]=s),o&&o()},loadersExists:function(e,t){for(var s,r=0,o=[];s=e[r++];)this.loaders[s]||o.push(s);return o.length?this.use({WjsLoader:o},{stack:!1,complete:t}):t()},process:function(e,t){return new(this.classProto("WjsProcess"))(e,t,this)},use:function(e,t){var s=this.extendArgs(arguments);return s[1]&&(s[1].async=s[1].async!==!1),this.process(s[0],s[1])},get:function(e,t){var s=this.extLoaded[e];return s&&s.hasOwnProperty(t)?s[t]:!1},destroy:function(e,t,s){var r=this,o=r.extendArgs(arguments),n=o[0];if(s=o[1],"boolean"==typeof s&&(s={}),s=r.extendObject({destroy:!0,dependencies:arguments[1]===!0||arguments[2]===!0},r.extendOptions(s)),s.async=s.async===!0,n.WjsLoader&&Object.keys(n).length>1){var i={WjsLoader:n.WjsLoader},a=this.extendObject({},s);return a.complete=function(){r.destroy(i,s)},delete n.WjsLoader,this.destroy(n,a)}return r.process(n,s)},extIsCore:function(e,t){return"WjsLoader"===e&&("WjsLoader"!==t||"JsLink"!==t||-1!==this.loadersBasic.indexOf(t))},requirementsDeletable:function(e,t){var s={},r=this.extRequire[e][t];return r&&this.regEach(r,function(r,o){this.extIsCore(r,o)||this.requireShared(e,t,r,o,s)||(s[r]=s[r]||[],s[r].push(o))}),s},requireShared:function(e,t,s,r,o){var n=this,i=!1;return n.regEach(n.extRequire,function(a,c){var d=n.extRequire[a][c];return a===e||c===t||!d[s]||-1===d[s].indexOf(r)||o&&o[a]&&-1!==o[a].indexOf(c)?void 0:(i=!0,!1)}),i},regEach:function(e,t){for(var s,r,o,n,i=0,a=Object.keys(e);r=a[i++];)for(n=Array.isArray(e[r])?e[r]:Object.keys(e[r]),s=0;o=n[s++];)if(t.call(this,r,o)===!1)return!1;return!0},regRem:function(e,t,s){delete e[t][s],this.objectIsEmpty(e[t])&&delete e[t]},regNext:function(e){var t,s=Object.keys(e)[0];return s&&(t=Object.keys(e[s])[0])?{type:s,name:t,data:e[s][t]}:!1},ajax:function(e){var t=new this.window.XMLHttpRequest,s=e.data?this.param(e.data):void 0,r=e.method||"GET",o=e.success,n=e.url;t.open(r,"GET"===r&&s?n+"?"+s:n,void 0!==e.async?e.async:!0),t.onreadystatechange=function(){4===t.readyState&&(200===t.status?o&&"function"==typeof o&&o(t):e.error&&e.error(t))},"POST"===r&&t.setRequestHeader("Content-type","application/x-www-form-urlencoded"),t.send(s)},param:function(e){for(var t,s=0,r=[],o=Object.keys(e);t=o[s++];)r.push(t+"="+e[t]);return r.join("&")},extendObject:function(e,t,s){for(var r,o,n=0,i=Object.keys(t);r=i[n++];)o=t[r],s&&"object"===("undefined"==typeof o?"undefined":_typeof(o))&&null!==o?(e[r]=e[r]||(Array.isArray(o)?[]:{}),this.extendObject(e[r],o)):e[r]=o;return e},extendArgs:function(e){var t=e[0],s=e[1],r={};return"string"==typeof t&&(r[t]=[s],t=r,s=e[2]),[t,s]},extendOptions:function(e){return e?"function"==typeof e&&(e={complete:e}):e={},e},extendProto:function(e,t){for(var s,r=0,o=Object,n=o.keys(t);s=n[r++];)o.defineProperty(e,s,o.getOwnPropertyDescriptor(t,s));return e},objectIsEmpty:function(e){for(var t in e)if(e.hasOwnProperty(t))return!1;return!0},classExtend:function(e,t){var s=this.classMethods;s[e]?this.extendProto(s[e],t):(s[e]=t,s[e].protoClassName=e),delete this.classProtos[e]},classProto:function(e){var t=this.classProtos,s=this.classMethods[e];if(!t[e]){var r,o,n=Object;r=s&&s.classExtends?s.classExtends:!1,r&&(n=this.classProto(r)),o=t[e]=function(){var e=this.__construct;e&&(arguments.length?e.apply(this,arguments):e.call(this))},o.prototype=Object.create(n.prototype),o.prototype.constructor=n,o.prototype.className=e,o.prototype.w=this,s&&this.extendProto(t[e].prototype,s)}return t[e]},classProtoDestroy:function(e,t){var s=this.classProtos,r=this.classMethods;s[e]&&delete s[e],!t&&r[e]&&delete r[e]},onload:function(e,t){var s=!1,r=function o(){s||(s=!0,e.removeEventListener("load",o),t())};e.addEventListener("load",r),this.async(r,200)},err:function(e,t){var s=this.window.console,r="["+this.settings.clientName+" error] : ";if(t||!s)throw new this.window.Error(r+e);s.error(r+e)}},s.lib={},s.reg={},s.readyCallbacks={},s.context=e,s.ready=function(t,s){var r=this.readyCallbacks;"function"==typeof t&&(s=t,t="w"),e[t]&&e[t].readyComplete===!0?e[t].async(s):(r[t]=r[t]||[],r[t].push(s))},s.trigger=function(t,s,r){var o=e.window,n=o.document.createEvent("CustomEvent");n.initCustomEvent(t,!0,!0,s||null),(r||o).dispatchEvent(n)},s.listenOnce=function(t,s){var r=function o(){e.window.removeEventListener(t,o),s()};e.window.addEventListener(t,r)},s.register=function(e,t,r){var o=this.reg;o[e]=o[e]||{},o[e][t]=r,s.trigger(["wjsRegister",e,t].join("::"))},s.retrieve=function(e,t){var s=this.reg;return s[e]&&s[e][t]?s[e][t]:!1},s.registerListen=function(e,t,r){var o=this,n=s.retrieve(e,t);n?r(n):s.listenOnce("wjsRegister::"+e+"::"+t,function(){r(o.reg[e][t])})},s.cache=function(e,t,r){s.register("cache",e+"/"+t,r)},s._e=function(){},e.W=s,t(function(){e.w||new s},e)}(void 0);
//# sourceMappingURL=w.min.js.map
