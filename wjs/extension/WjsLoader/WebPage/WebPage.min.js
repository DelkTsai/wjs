// @require JsClass > BasicWebPage
// @require JsClassStatic > QueueManager
// @require JsMethod > extEnable
// @require JsMethod > extDisable
// @require JsMethod > wjsRegDiffName
(function(k){k.register("WjsLoader","WebPage",{loaderExtends:"WebComp",protoBaseClass:"BasicWebPage",pageCurrent:null,destroyDelay:5E3,__construct:function(){this.destroyTimeouts={};this.pageRequireStatic=[];this.pageInstances=[];this.wjs.loaders.WebComp.__construct.call(this);this.queueName=this.type+"PageLoads"},link:function(b){this.pageShow(b)},enable:function(b,a,c){c&&c.options.webPagePreload||(this.pageCurrent=this.instance(b,a))},pageChange:function(b){this.pageCurrent[b]&&this.pageHide(this.pageCurrent[b])},
pageShow:function(b){var a=this,c=a.wjs,d=a.type;c.queueAdd(a.queueName,function(){if(a.pageCurrent)a.pageHide(b),a.wjs.queueNext(a.queueName);else if(a.destroyTimeoutClear(b),c.get(d,b))if(c.extRequire[d]&&c.extRequire[d][b]&&c.extRequire[d][b].CssLink){for(var f=0,e,g=function(){for(f=0;e=c.extRequire[d][b].CssLink[f++];){var h=c.get("CssLink",e);h.sheet&&h.sheet.rules?(c.extEnable(d,b),a.wjs.queueNext(a.queueName)):c.window.setTimeout(g,100)}};e=c.extRequire[d][b].CssLink[f++];)c.loaders.CssLink.enable(e,
c.get("CssLink",e));c.window.setTimeout(g,100)}else c.extEnable(d,b),a.wjs.queueNext(a.queueName);else a.wjs.use(d,b,{complete:function(){a.wjs.queueNext(a.queueName)}})})},pageHide:function(b,a){var c=this;c.wjs.queueAdd(c.queueName,function(){var d=c.pageCurrent,f=b?!1:!0,e=d?!1:!0,g=function(){f&&e&&(d&&(c.wjs.extDisable(d.loader.type,d.type),d.loader.destroyTimeout(d.type)),c.pageCurrent=!1,c.pageHideStarted=!1,a&&a(),c.wjs.queueNext(c.queueName),b&&c.pageShow(b))};b&&(c.destroyTimeoutClear(b),
c.wjs.use(c.type,b,{webPagePreload:!0,complete:function(){f=!0;g()}}));d&&c.pageCurrent.exit(function(){e=!0;g()});b||d||g()})},destroyTimeout:function(b){var a=this;a.destroyTimeouts[b]=a.wjs.window.setTimeout(function(){delete a.destroyTimeouts[b];if(!a.pageCurrent)a.wjs.destroy(a.type,b,{dependencies:!0});else if(a.pageCurrent.name!==b){var c=a.wjs.wjsRegDiffName(a.type,b,a.type,a.pageCurrent.type);Object.keys(c).length?(c[a.type]=c[a.type]||[],c[a.type].push(b)):a.wjs.destroy(a.type,b)}},a.destroyDelay)},
destroyTimeoutClear:function(b){this.destroyTimeouts[b]&&this.wjs.window.clearTimeout(this.destroyTimeouts[b])}})})(WjsProto);