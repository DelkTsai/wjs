// @require JsClass > BasicWebComp
// @require JsMethod > inheritMethod
// @require JsMethod > inheritLinage
// @require JsMethod > arrayDeleteItem
(function(h){h.register("JsClass","BasicBinder",{classExtends:"BasicWebComp",type:"Binder",variables:{cssClasses:null,listeners:{},statesVars:{},stateConnected:{},stateListener:{}},states:{},options:{cssClasses:{define:function(a){a=a||[];this.loader.classLists[this.typeGlobal]&&(this.cssClasses=a.concat(this.loader.classLists[this.typeGlobal]))}}},__construct:function(a){this.wjs.inheritMethod(this,"__construct",arguments);this.wjs.inheritLinage(this,"callbacks");this.wjs.inheritLinage(this,"states");
this.variableSetWrapper=this._variableSetWrapper},cssRulesClassInit:function(){var a=this.wjs.inheritMethod(this,"cssRulesClassInit",arguments),b=0,c;c=this.loader.protoName(this.type);var d=this.loader.domStyle[c];if(d)for(;c=this.loader.classLists[this.typeGlobal][b++];)this.cssRulesClassSearch(d.sheet,c)&&(a=!0);return a},callbackFind:function(a,b){var c=this.callbacks[b];return"function"===typeof a?a:c&&c[a]?c[a]:!1},domChildFill:function(a,b){this.wjs.inheritMethod(this,"domChildFill",arguments);
this.trigger("domChildFill",[a,b])},domChildRemove:function(a){a=this.domChildGet(a);a.parentNode.removeChild(a)},domStyleGet:function(a){return this.wjs.window.getComputedStyle(this.dom,null).getPropertyValue(a)},domRect:function(){return this.dom.getBoundingClientRect()},_variableSetWrapper:function(a,b){this.trigger("variableSet",[a,b]);this.wjs.inheritMethod(this,"variableSetWrapper",arguments);var c=this.callbackFind(a,"variableSet");c&&c(b)},stateSet:function(a,b,c){var d=this.states[a],e;b!==
d&&(this.states.hasOwnProperty(a)||this.error("Trying to set undefined state "+a),e=this.callbackFind(a,"stateSet"),this.states[a]=b,this.statesVars[a]=this.statesVars[a]||{},this.wjs.extendObject(this.statesVars[a],c||{}),e&&e(b,c,d),this.trigger("stateSet",[a,b,d]))},stateGet:function(a){return this.states[a]},stateIs:function(a,b){"string"===typeof a&&(a={},a[a]=b);for(var c=0,d=Object.keys(a);c<d.length;c++)if(this.states[d[c]]!==a[d[c]])return!1;return!0},stateVar:function(a,b){return this.statesVars[a][b]},
stateListen:function(a,b,c,d){c=this.callbackFind(c,"stateListen");this.stateListener[a.id]=this.stateListener[a.id]||{};this.stateListener[a.id][b]=c;1===Object.keys(this.stateListener[a.id]).length&&this.listen(a,"stateSet","stateListen");d&&c.apply(this,[a,b,a.stateGet(b)])},stateForget:function(a,b,c,d){var e=this.stateListener[a.id];c=this.callbackFind(c,"stateListen");d&&this.callbackFind(c,"stateListen").apply(this,[a,b,a.stateGet(b)]);delete e[b];0===Object.keys(e).length&&this.forget(a,"stateSet",
"stateListen")},stateConnect:function(a,b,c,d){var e=this.stateConnected;e[a.id]=e[a.id]||{};e[a.id][b]=e[a.id][b]||[];e[a.id][b].push(c);this.stateListen(a,b,this.callbackFind("stateConnect","stateListen"),d)},stateDisconnect:function(a,b,c,d){var e=this.stateConnected;if(e=e[a.id]?e[a.id][b]:void 0)this.wjs.arrayDeleteItem(e,c),this.stateForget(a,b,this.callbackFind("stateConnect","stateListen"),d)},listen:function(a,b,c){c=this.callbackFind(c,"listen");return a.listenerAdd(b,this,c)?!0:!1},forget:function(a,
b){return a.listenerRemove(b,this)?!0:!1},hasListener:function(a,b){return this.listeners[a]&&this.listeners[a][b.id]},listenerAdd:function(a,b,c){return this.hasListener(a,b)?!1:(this.listeners[a]=this.listeners[a]||{},this.listeners[a][b.id]=c,!0)},listenerRemove:function(a,b){this.hasListener(a,b)&&(delete this.listeners[a][b.id],0===Object.keys(this.listeners[a]).length&&delete this.listeners[a])},trigger:function(a,b){var c={},d=0,e,g=this.listeners[a]||{},f=Object.keys(g);b=b||[];for(b.unshift(this);d<
f.length;d++)(e=this.wjs.loaders.WebComp.webCompList[f[d]])&&(c[e.id]=g[f[d]].apply(e,b));return c},domCallbacks:[],domCallbacksItems:{},domListen:function(a,b,c){this.domNodeListMap("domListen",arguments)||(c=this.callbackFind(c||b,"domListen"),a.addEventListener(b,c))},domForget:function(a,b,c){this.domNodeListMap("domForget",arguments)||(c=this.callbackFind(c||b,"domListen"),a.removeEventListener(b,c))},domNodeListMap:function(a,b){var c=this,d;return b[0]instanceof c.wjs.window.NodeList?(d=c.wjs.extendObject([],
b),Array.prototype.slice.call(b[0]).map(function(b){d[0]=b;c[a].apply(c,d)},this),!0):!1},callbacks:{listen:{stateListen:function(a,b,c,d){var e=this.stateListener[a.id]?this.stateListener[a.id][b]:void 0;e&&e.apply(this,[a,b,c,d])}},stateListen:{stateConnect:function(a,b,c){a=this.stateConnected[a.id]?this.stateConnected[a.id][b]:void 0;b=0;var d;if(a)for(d=Object.keys(a);b<d.length;b++)this.stateSet(a[d[b]],c)}}}})})(WjsProto);