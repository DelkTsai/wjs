// @require WjsLoader > WebCom
// @require JsScript > SchemeBinder
(function(m){m.register("WjsLoader","Binder",{loaderExtends:"WebCom",protoBaseClass:"Binder",regReplaceSlashes:/\./g,__construct:function(){this.wjs.extendObject(this,{domStyle:{},cssSheetLoadQueue:[],classSaved:{},classLists:{},cssClassCounter:0,cssDomItems:{},cssRewritten:{}});this.wjs.loaders.WebCom.__construct.call(this)},parse:function(a,c,d){var b=this.type,f=this.wjs.loaders.WebCom.parse.apply(this,arguments),e=this.protoName(a);this.cssSheetLoadQueue=[];c.css&&this.cssDomInitType(e,c.css,
!0);this.cssSheetLoadAll(function(){d.itemParseComplete(b,a,f)});return!1},protoAddPart:function(a){var c=this.protoName(a);this.wjs.loaders.WebCom.protoAddPart.apply(this,arguments);this.cssClassInit(c,!0)},cssSheetLoadAll:function(a){var c=this,d=function(){var b=c.cssSheetLoadQueue.shift();b?c.wjs.cssSheetLoad(b,d):a&&a()};d()},cssDomInitType:function(a,c,d){var b=this.domStyle,f=this.cssDomItems;d?(f[a]=f[a]||0,f[a]++,c&&!b[a]&&(b[a]=this.wjs.document.createElement("style"),b[a].innerHTML=c.replace(/(url\(["'])(?!http[s]*:\/\/)/g,
"$1"+c.client),this.cssSheetLoadQueueAppend(b[a]),this.wjs.document.head.appendChild(b[a]))):(f[a]--,0===f[a]&&b[a]&&(b[a].parentNode.removeChild(b[a]),delete b[a]))},cssSheetLoadQueueAppend:function(a){-1===this.cssSheetLoadQueue.indexOf(a)&&this.cssSheetLoadQueue.push(a)},cssClassInit:function(a,c){for(var d=0,b,f=!1,e,k=this.wjs.classProtoLineage(a),l=[],h=k.join("-"),g=this.cssRewritten;b=k[d++];)l.push(b),"Binder"===b&&(f=!0),f&&(b=b.replace(this.regReplaceSlashes,"_"),e=l.join("-"),c?(this.cssClassAdd(e,
h),this.cssRewriteAll(b,this.classSaved[e]),g[e]=g[e]||0,g[e]++,-1===this.classLists[h].indexOf(this.classSaved[e])&&this.classLists[h].push(this.classSaved[e])):(g[e]--,g[e]||(this.cssRewriteAll(this.classSaved[e],b),this.cssClassRemove(e,h))))},cssClassAdd:function(a,c){var d=this.classSaved,b=this.classLists;d[a]||(d[a]="c"+this.cssClassCounter++);b[c]=b[c]||[]},cssClassRemove:function(a,c){var d=this.classLists;this.classSaved[a]&&delete this.classSaved[a];d[c]&&delete d[c]},cssRewriteAll:function(a,
c){for(var d=0,b=this.domStyle,f=Object.keys(b);d<f.length;d++)this.cssRewrite(a,c,b[f[d]])},cssRewrite:function(a,c,d){d.innerHTML=d.innerHTML.replace(RegExp("\\."+a+"(?=[\\s*|{|,|.|-|:])","g"),"."+c);this.cssSheetLoadQueueAppend(d)}})})(WjsProto);