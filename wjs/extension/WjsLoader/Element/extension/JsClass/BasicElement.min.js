// @require JsClass > BasicBinder
// @require JsMethod > arrayDeleteItem
(function(f){f.register("JsClass","BasicElement",{type:"Element",classExtends:"BasicBinder",variables:{parent:null,children:[],listeners:{},plugins:{},pluginsList:[]},options:{parent:{defaults:null,define:function(a,b){a&&a.isA("Element")&&a.elementAppend(this)},destroy:function(){null!==this.parent&&this.parent.elementRemove(this)}},children:{define:function(a){if("object"===typeof a)for(var b=Object.keys(a),c=0,d;d=a[b[c++]];)d=this.wjs.extendObject({},d),this.childAdd(d)}},parentShortcut:{defaults:!1,
define:function(a){a&&this.parent&&(this.parent[a]=this)}}},states:{renderEnabled:!0},__construct:function(a){this.wjs.inheritMethod(this,"__construct",arguments);this.render()},exit:function(){this.pluginsClear();this.empty();this.wjs.inheritMethod(this,"exit",arguments)},childAdd:function(a){var b=this.wjs,c;c=a.type?a.type.split("::"):["Element",!1];delete a.type;a.parent=this;return b.loaders[c[0]].instance(c[1],a)},elementAdd:function(a,b){b=b||{};b.type="Element::"+a;return this.childAdd(b)},
elementAppend:function(a){a.parent&&a.parent.elementRemove(a);this.dom&&a.dom&&!a.dom.parentNode&&this.dom.appendChild(a.dom);this.children.push(a);a.parent=this},elementAppendTo:function(a){a.elementAppend(this)},elementRemove:function(a){this.wjs.arrayDeleteItem(this.children,a);a.parent=null;this.trigger("elementRemove",[a])},treeMap:function(a,b){var c="string"===typeof a?this[a]:a;this.childrenMap("treeMap",arguments);c.apply(this,b)},childrenMap:function(a,b){for(var c=0,d,e="function"===typeof a;d=
this.children[c++];)e?a.apply(d,b):d[a].apply(d,b)},pluginAdd:function(a,b,c){var d=this.wjs,e=this.plugins,f=this.pluginsList;b=d.extendOptions(b,{binder:this});b=d.loaders.Plugin.instance(a,b);e[a]=e[a]||[];e[a].push(b);f.push(b);c&&c(b);return b},pluginGet:function(a){return this.plugins[a]?1===this.plugins[a].length?this.plugins[a][0]:this.plugins[a]:!1},pluginRemove:function(a){var b={},c=this.plugins,d;if("string"===typeof a)return this.pluginRemove(this.pluginGet(a));if(a instanceof Array){for(a=
0;d=c[a++];)b[a]=this.pluginRemove(d);return b}a.exit();this.wjs.arrayDeleteItem(c[a.type],a);this.wjs.arrayDeleteItem(this.pluginsList,a);0===Object.keys(c[a.type]).length&&delete c[a.type]},pluginsClear:function(){for(var a=0,b;b=this.pluginsList[a++];)this.pluginRemove(b)},pluginsHook:function(a,b){for(var c=0,d;d=this.pluginsList[c++];)if("function"===typeof d[a])d[a](b)},render:function(a){!0!==this.stateGet("renderEnabled")||a&&a!==this.player&&!0!==this.playerPropagate||(a=this.renderReset(),
this.renderDom(a),this.renderChildren(),this.pluginsHook("renderPostprocess",a),this.trigger("render",[a]))},renderReset:function(){return{}},renderDom:function(a){},renderChildren:function(a){for(var b=0;b<this.children.length;b++)this.children[b].render(a)},empty:function(){for(;0<this.children.length;)this.children[0].exit()}})})(WjsProto);