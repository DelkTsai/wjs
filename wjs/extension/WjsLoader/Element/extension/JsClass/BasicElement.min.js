// @require JsMethod > arrayDeleteItem
(function(g){g.register("JsClass","BasicElement",{type:"Element",classExtends:"BasicBinder",variables:{parent:null,children:[],listeners:{},plugins:{},pluginsList:[],frameNextEnabled:!1,global:!1,globalParents:{},playFrameStamp:0,playFrameExecuteProxy:null},options:{global:{defaults:!1},fps:{defaults:24,apply:!0,dump:!0},playPlayer:{defaults:null,define:function(a){a&&(this.playPlayer=a,!0===this.playPlayer?this.playPlayer=this:null===this.playPlayer&&null!==this.parent&&null!==this.parent.playPlayer&&
(this.playPlayer=this.parent.playPlayer),!0===this.playPlayer.playStarted&&this.stateSet("playing"))}},autoPlay:{defaults:!1,define:function(a){a&&this.play()},dump:!0},children:{define:function(a){if("object"===typeof a)for(var c=Object.keys(a),b=0,d;d=a[c[b++]];)d=this.wjs.extendObject({},d),this.childAdd(d)}},parentShortcut:{defaults:!1,define:function(a){a&&this.parent&&(this.parent[a]=this)}},plugins:{defaults:[],define:function(a){this.pluginAddMultiple(a)},dump:[]},parent:{defaults:null,define:function(a){a&&
a.isA("Element")&&a.elementAppend(this)},destroy:function(){null!==this.parent&&this.parent.elementRemove(this)}}},states:{renderEnabled:!0},__construct:function(a){this.wjs.inheritMethod(this,"__construct",arguments);this.playFrameExecuteProxy=this.playFrameExecute.bind(this);this.render()},exit:function(){this.stop();this.pluginsClear();this.empty();this.wjs.inheritMethod(this,"exit",arguments)},childAdd:function(a){var c=this.wjs,b;b=a.type?a.type.split("::"):["Element",!1];delete a.type;a.parent=
this;return c.loaders[b[0]].instance(b[1],a)},elementAppend:function(a){a.parent&&a.parent.elementRemove(a);this.dom&&a.dom&&this.dom.appendChild(a.dom);this.children.push(a);this.wjs.extendObject(a.globalParents,this.globalParents);this.global&&(a.globalParents[this.id]=this);a.parent=this;for(var c=Object.keys(a.globalParents),b,d=0;b=c[d++];)a.globalParents[b].globalChildAppend(a)},elementAppendTo:function(a){a.elementAppend(this)},elementRemove:function(a){for(var c=Object.keys(a.globalParents),
b,d=0;b=c[d++];)a.globalParents[b].globalChildRemove(a);this.wjs.arrayDeleteItem(this.children,a);a.parent=null;a.globalParents={}},globalChildAppend:function(a){},globalChildRemove:function(a){},treeMap:function(a,c){var b="string"===typeof a?this[a]:a;this.childrenMap("treeMap",arguments);b.apply(this,c)},childrenMap:function(a,c){for(var b=0,d,f="function"===typeof a;d=this.children[b++];)f?a.apply(d,c):d[a].apply(d,c)},pluginAdd:function(a,c,b){var d=this.wjs,f=this.plugins,e=this.pluginsList;
"object"===typeof a?(d=a,b=c,a=a.type):d=d.loaders.Plugin.instanceOnce(a,c);d.binderAdd(this);f[a]=f[a]||[];f[a].push(d);e.push(d);this.render();b&&b(d);return d},pluginAddMultiple:function(a,c,b){for(var d=0,f,e;e=a[d++];)b&&this.pluginGet(e.type)||(c&&this.wjs.extendObject(e,c),e.isA&&e.isA("Plugin")?(f=e,e=void 0):f=e.type,this.pluginAdd(f,e))},pluginRemoveMultiple:function(a){for(var c=0,b;b=a[c++];)b=b.type||b,this.pluginGet(b)&&this.pluginRemove(b)},pluginGet:function(a){return this.plugins[a]?
1===this.plugins[a].length?this.plugins[a][0]:this.plugins[a]:!1},pluginRemove:function(a){var c={},b=this.plugins,d;if("string"===typeof a)return this.pluginRemove(this.pluginGet(a));if(a instanceof Array){for(a=0;d=b[a++];)c[a]=this.pluginRemove(d);return c}a.binderRemove(this);this.wjs.arrayDeleteItem(b[a.type],a);this.wjs.arrayDeleteItem(this.pluginsList,a);0===Object.keys(b[a.type]).length&&delete b[a.type]},pluginsClear:function(){for(var a=0,c;c=this.pluginsList[a++];)this.pluginRemove(c)},
pluginsHook:function(a,c){for(var b=0,d;d=this.pluginsList[b++];)if("function"===typeof d[a])d[a](c)},render:function(a){!0!==this.stateGet("renderEnabled")||a&&a!==this.player&&!0!==this.playerPropagate||(a=this.renderReset(),this.parent&&this.parent.renderChild(this,a),this.renderDom(a),this.renderChildren())},renderReset:function(){return{}},renderDom:function(a){},renderChildren:function(a){for(var c=0,b;b=this.children[c++];)b.render(a)},renderChild:function(a,c){},empty:function(){for(;0<this.children.length;)this.children[0].exit()},
play:function(){this.playStarted=!0;this.treeMap("playStateStart",[this]);this.playStampStart=(new Date).getTime();this.frameNextEnable();this.playFrameExecute();this.trigger("playStarted",[this])},stop:function(){this.treeMap("playStateQuit",[this]);this.playStarted=!1;this.trigger("play_stopped",[this])},playStateStart:function(a){if(a===this.playPlayer){this.stateSet("playing");for(var c in this.pluginsList)this.pluginsList.hasOwnProperty(c)&&this.pluginsList[c].stateSet("playing")}},playStateQuit:function(a){if(a===
this.playPlayer){this.stateQuit("playing");for(var c in this.pluginsList)this.pluginsList.hasOwnProperty(c)&&this.pluginsList[c].stateQuit("playing")}},playFrameNumber:function(){return!1===this.playStarted?0:Math.round((this.playFrameStamp-this.playStampStart)/1E3*this.fps)},playFrameExecute:function(){this.frameNextEnabled=!1;this.playFrameStamp=(new Date).getTime();this.playFrameCurrent=this.playFrameNumber();this.render()},playFrameNextLaunch:function(){this.frameNextEnabled&&setTimeout(this.playFrameExecuteProxy,
1E3/this.fps*(this.playFrameCurrent+1)+this.playStampStart-this.playFrameStamp)},frameNextEnable:function(){!1===this.frameNextEnabled&&null!==this.playPlayer&&!0===this.playPlayer.playStarted&&(this.playPlayer!==this?this.playPlayer.frameNextEnable():(this.frameNextEnabled=!0,this.playFrameNextLaunch()))},frame:function(){this.play();this.stop()}})})(WjsProto);