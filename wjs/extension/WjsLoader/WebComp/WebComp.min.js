// @require WjsLoader > JsMethod
// @require WjsLoader > CssLink
// @require WjsLoader > JsLink
// @require WjsLoader > JsClass
// @require WjsLoader > JsClassStatic
// @require JsMethod > objectToArray
// @require JsMethod > urlQueryParse
// @require JsMethod > urlQueryBuild
// @require JsClassStatic > wjsHref
// @require JsClass > BasicWebComp
// @require JsMethod > staticClass
// @require JsMethod > wjsIncludeTag
// @require JsMethod > wjsIncludeTagDestroy
// @require JsMethod > cssAnimateCallback
// @require JsMethod > wjsIncludeTagExit
(function(k){k.register("WjsLoader","WebComp",{__construct:function(){this.staticClasses={};k.proto.Loader.__construct.call(this)},parse:function(c,b,d){var e=d.options.destination||b.destination;k.registerGet(this.type,c)&&this.registerListen(this.type,c,d,b);this.include(c,e,b);return b},register:function(c,b,d,e){c=k.retrieve(this.type,b);c.classExtends="BasicWebComp";this.staticClasses[b]=this.wjs.staticClass(this.type+b,c)},include:function(c,b,d){var e=this.wjs,a=this.type,f=e.loaders.JsClassStatic.staticClasses.wjsHref,
h=this.staticClasses,g=e.document.createElement("div");d=d||e.get(a,c);d.dom=g;g.innerHTML=d.html;g.classList.add(a+"-"+c);b&&(d.domDestination="string"===typeof b?e.window.document.querySelector(b):b,d.domDestination.appendChild(g),f&&f.linksInit(d.domDestination));d.urlUpdate&&(b=e.urlQueryParse(),b[a]=b[a]||[],d.group?(b[a][d.group]&&b[a][d.group]!==c&&e.destroy(a,b[a][d.group],!0),b[a][d.group]=c):-1===b[a].indexOf(c)&&b[a].push(c),e.window.history.replaceState(null,null,"?"+e.urlQueryBuild(b)));
h[c]||(h[c]=new (e.classProto("BasicWebComp")));e.extendObject(h[c],d);h[c].init(d);h[c].fadeInClass&&e.cssAnimateCallback(g,"fadeIn",!0);e.wjsIncludeTag(g)},destroy:function(c,b,d){var e=this,a=e.staticClasses[c],f=function(){a.fadeOutComplete&&a.destroyChildComplete&&e.destroyComplete(c,b,d)};if(!a)return!0;a.destroyChildComplete=!1;e.webCompExit(c,f);wjs.wjsIncludeTagDestroy(b.dom,function(){a.destroyChildComplete=!0;b.dom.classList.add("fadeOutChildrenComplete");f()});return!1},destroyComplete:function(c,
b,d){var e=!0,a;a=this.staticClasses[c];if(!(b instanceof this.wjs.window.Error)&&(a&&a.exit&&(e=a.exit(this.type,c,b,d)),b.urlUpdate&&(a=this.wjs.urlQueryParse(),a[this.type]))){if(b.group)delete a[this.type][b.group];else for(b=a[this.type].indexOf(c);-1!==b;)a[this.type].splice(b,1),b=a[this.type].indexOf(c);this.wjs.window.history.replaceState(null,null,"?"+this.wjs.urlQueryBuild(a))}e&&d.itemDestroyComplete(this.type,c)},domRemove:function(c){c.dom.parentNode&&c.dom.parentNode.removeChild(c.dom)},
webCompExit:function(c,b){var d=this,e=d.wjs,a=d.staticClasses[c],f="string"===typeof a.fadeOutClass?a.fadeOutClass:"fadeOut";if(!a)return!1;e.wjsIncludeTagExit(a.dom);if(!0===a.fadeOutStarted)return b&&a.fadeOutCallback.push(b),!1;if(!a.fadeOutClass||!0===a.fadeOutComplete)return a.fadeOutComplete=!0,!1;a.fadeOutStarted=!0;a.fadeOutComplete=!1;a.fadeOutCallback=b?[b]:[];e.cssAnimateCallback(a.dom,f,function(b){d.domRemove(a);a.dom.classList.remove(f);b.stopPropagation();a.fadeOutComplete=!0;a.fadeOutCallback&&
a.fadeOutCallback.length&&e.callbacks(a.fadeOutCallback)});return!0}})})(WjsProto);