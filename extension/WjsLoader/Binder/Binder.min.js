// @require WjsLoader > WebComp
// @require JsClass > BasicBinder
(function(l){l.register("WjsLoader","Binder",{loaderExtends:"WebComp",protoBaseClass:"BasicBinder",__construct:function(){this.wjs.extendObject(this,{domStyle:{},cssSheetLoadQueue:[],classSaved:{},classLists:{},cssClassCounter:0,cssDomItems:{},cssRewritten:{},regReplaceSlashes:/\./g});this.wjs.loaders.WebComp.__construct.call(this)},parse:function(a,d,b){var c=this.type,e=this.wjs.loaders.WebComp.parse.apply(this,arguments),f=this.protoName(a);return d.css?(this.cssDomInit(f,d.css,!0),this.cssClassInit(f,
!0),this.cssSheetLoadAll(function(){b.itemParseComplete(c,a,e)}),!1):e},cssSheetLoadAll:function(a){var d=this,b=function(){var c=d.cssSheetLoadQueue.shift();c?d.wjs.cssSheetLoad(c,b):a&&a()};b()},cssDomInit:function(a,d,b){for(var c=0,e=this.wjs.classProtoLineage(a);a=e[c++];)this.cssDomInitType(this.protoName(a),d,b)},cssDomInitType:function(a,d,b){var c=this.domStyle,e=this.cssDomItems;b?(e[a]=e[a]||0,e[a]++,d&&!c[a]&&(c[a]=this.wjs.document.createElement("style"),c[a].innerHTML=d.replace(/(url\(["'])(?!http[s]*:\/\/)/g,
"$1"+d.client),this.cssSheetLoadQueue.push(c[a]),this.wjs.document.head.appendChild(c[a]))):(e[a]--,0===e[a]&&c[a]&&(c[a].parentNode.removeChild(c[a]),delete c[a]))},cssClassInit:function(a,d){for(var b=0,c=!1,e,f,g=this.wjs.classProtoLineage(a),k=[],h=g.join("-");b<g.length;b++)k.push(g[b]),"Binder"===g[b]&&(c=!0),c&&(e=g[b].replace(this.regReplaceSlashes,"_"),f=k.join("-"),d?(this.cssClassAdd(f,h),this.cssRewriteAll(e,this.classSaved[f]),this.cssRewritten[f]=this.cssRewritten[f]||0,this.cssRewritten[f]++,
-1===this.classLists[h].indexOf(this.classSaved[f])&&this.classLists[h].push(this.classSaved[f])):(this.cssRewritten[f]--,0===this.cssRewritten[f]&&(this.cssRewriteAll(this.classSaved[f],e),this.cssClassRemove(f,h))))},cssClassAdd:function(a,d){var b=this.classSaved,c=this.classLists;b[a]||(b[a]="c"+this.cssClassCounter++);c[d]=c[d]||[]},cssClassRemove:function(a,d){var b=this.classLists;this.classSaved[a]&&delete this.classSaved[a];b[d]&&delete b[d]},cssRewriteAll:function(a,d){for(var b=0,c=this.domStyle,
e=Object.keys(c);b<e.length;b++)this.cssRewrite(a,d,c[e[b]])},cssRewrite:function(a,d,b){b.innerHTML=b.innerHTML.replace(RegExp("\\."+a+"(?=[\\s*|{|,|.|-|:])","g"),"."+d);this.cssSheetLoadQueue.push(b)}})})(WjsProto);